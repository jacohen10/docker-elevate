<% if current_user%>
  <div class="jumbotron vertical-center">
    <h2>
      <%=@customer.name%>
      <% if current_user %>
        <%= link_to "Edit", edit_customer_path(@customer), class:  "btn btn-default"%>
      <%end%>
    </h2>
    <div class="mealPlan">
      <ul>
        <li>Plan selected: <%=@customer.plan %></li>
        <li class="meals_remaining">Meals remaining: <%=@meals_remaining %></li>
      </ul>
    </div>
    <% flash.each do |type, message| %>
      <p class="<%= type %>"><%= message %></p>
    <% end %>
    <% if current_user.role == "admin"%>
      <%= link_to "Delete", customer_path(@customer), class: "btn btn-default", method: :delete%>
    <%end%>
    <h3>Restaurants:</h3>
    <%if @meals_remaining > 0 && @customer.verification === "true"%>
      <%@restaurants.each do |restaurant| %>
      <%if (restaurant.open_times.where(day: Time.now.strftime("%A")).count ===1 && ((restaurant.open_times.find_by(day:Time.now.strftime("%A")).opening.strftime("%H.%M") < Time.now.strftime("%H.%M")) && (restaurant.open_times.find_by(day:Time.now.strftime("%A")).closing.strftime("%H.%M") > Time.now.strftime("%H.%M")) )   ) %>
        <div class="restaurant">
          <h3><%=restaurant.name%></h3>
          <div class="container">
            <div class="row">
              <%= form_for [@customer,@meal] do |f| %>
                <div class="col-xs-12 col-md-6-offset-1">
                  <%=f.collection_select(:food_item,restaurant.menus.all, :name, :name) %>
                </div>
                <div class="col-xs-12 col-md-12">
                  <%= f.text_field :comment, placeholder: "meal requests..." %>
                  <%= f.hidden_field :restaurant_id, value: restaurant.id %>
                  <div class="order_ahead">
                    <%= f.label :order_ahead, 'Swipe', value: 'swipe' %>
                    <%= f.radio_button :order_ahead, 'swipe',value: 'swipe', checked: true %>
                    <%= f.label :order_ahead, 'Order Ahead', value: 'order_ahead' %>
                    <%= f.radio_button :order_ahead, 'order_ahead',value: 'order_ahead' %>
                    <%= f.hidden_field :status, value: "open" %>
                  </div>
                  <div id="submit_btn">
                    <%= f.submit "Add meal", class: "btn btn-primary" %>
                  </div>
                </div>
              <%end%>
            </div>
          </div>
        </div>
      <%end%>
      <%end%>
    <%else%>
      <%="You're out of meals, please purchase more in order to continue"%>
    <%end%>
    <h3>Meals:</h3>
    <div class="table-responsive">
      <table class="table table-striped">
        <th>Date/Time</th>
        <th>Status</th>
        <th>Restaurant</th>
        <th>Meal</th>
        <th>Cancel if open</th>
        <%@meals.each do |meal| %>
          <tr>
            <td><%=meal.created_at.strftime("%m/%d/%y %I:%M%p")%></td>
            <td><%=meal.status%></td>
            <td><%=Restaurant.find(meal.restaurant_id).name%></td>
            <td><%=meal.food_item%></td>
            <% if meal.status === "open"%>
            <td>
                <%= link_to "Cancel", customer_meal_path(@customer, meal), class: "btn btn-default", method: :delete%>
            </td>
            <%end%>
          </tr>
        <%end%>
      </table>
    </div>
  </div>
<%end%>

<script>
$(document).ready(function(){
  if (<%=@meals_remaining <= 5%>) {
  $(".meals_remaining").css("color", "red");
  }
});
</script>
